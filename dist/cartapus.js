!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e||self)["'Cartapus'"]=t()}(this,function(){function e(t,r){return e=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},e(t,r)}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function r(e,r){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,r){if(e){if("string"==typeof e)return t(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?t(e,r):void 0}}(e))||r&&e&&"number"==typeof e.length){n&&(e=n);var o=0;return function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function n(){}n.prototype={on:function(e,t,r){var n=this.e||(this.e={});return(n[e]||(n[e]=[])).push({fn:t,ctx:r}),this},once:function(e,t,r){var n=this;function o(){n.off(e,o),t.apply(r,arguments)}return o._=t,this.on(e,o,r)},emit:function(e){for(var t=[].slice.call(arguments,1),r=((this.e||(this.e={}))[e]||[]).slice(),n=0,o=r.length;n<o;n++)r[n].fn.apply(r[n].ctx,t);return this},off:function(e,t){var r=this.e||(this.e={}),n=r[e],o=[];if(n&&t)for(var s=0,i=n.length;s<i;s++)n[s].fn!==t&&n[s].fn._!==t&&o.push(n[s]);return o.length?r[e]=o:delete r[e],this}};var o=n;return o.TinyEmitter=n,/*#__PURE__*/function(t){var n,o;function s(e){var r;return void 0===e&&(e={}),(r=t.call(this)||this).intersect=r.intersect.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(r)),r.options=Object.assign({root:null,rootMargin:"0px",threshold:0,once:!1},e),r.observers=[r.createObserver()],r.getElems(),r.createObservers(),r.observe(),r}o=t,(n=s).prototype=Object.create(o.prototype),n.prototype.constructor=n,e(n,o);var i=s.prototype;return i.getElems=function(){var e=this.options.root?this.options.root:document;this.elems=e.querySelectorAll("[data-cartapus]")},i.createObservers=function(){for(var e,t=this,n=function(){var r=e.value;if(r.dataset.cartapusThreshold||r.dataset.cartapusRootMargin){var n=r.dataset.cartapusThreshold?parseFloat(r.dataset.cartapusThreshold):t.options.threshold,o=r.dataset.cartapusRootMargin?r.dataset.cartapusRootMargin:t.options.rootMargin,s=t.observers.find(function(e){return e.threshold===n&&e.rootMargin===o});s?s.elements.push(r):t.observers.push(t.createObserver({element:r,options:{threshold:n,rootMargin:o}}))}else t.observers[0].elements.push(r)},o=r(this.elems);!(e=o()).done;)n()},i.createObserver=function(e){var t=void 0===e?{}:e,r=t.element,n=Object.assign(this.options,t.options);return{observer:new IntersectionObserver(this.intersect,n),threshold:n.threshold,rootMargin:n.rootMargin,elements:r?[r]:[]}},i.intersect=function(e,t){for(var n,o=r(e);!(n=o()).done;){var s=n.value;s.isIntersecting?(s.target.setAttribute("data-cartapus","visible"),s.target.hasAttribute("data-cartapus-once")&&t.unobserve(s.target)):s.target.setAttribute("data-cartapus","hidden"),this.dispatch(s)}},i.dispatch=function(e){var t={element:e.target,visible:e.isIntersecting,intersection:e},r=new CustomEvent("cartapusintersect",{detail:t});e.target.dispatchEvent(r),this.emit("intersect",t)},i.observe=function(){for(var e,t=r(this.observers);!(e=t()).done;)for(var n,o=e.value,s=r(o.elements);!(n=s()).done;){var i=n.value;i._cartapus=o,o.observer.observe(i)}},i.unobserve=function(){for(var e,t=r(this.observers);!(e=t()).done;)for(var n,o=e.value,s=r(o.elements);!(n=s()).done;)o.observer.unobserve(n.value)},i.destroy=function(){this.unobserve();for(var e,t=r(this.observers);!(e=t()).done;)e.value.elements=[]},i.reset=function(){this.destroy(),this.init()},s}(o)});
