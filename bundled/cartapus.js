function t(e,r){return t=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},t(e,r)}function e(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,o=new Array(e);r<e;r++)o[r]=t[r];return o}function o(t,e){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(o)return(o=o.call(t)).next.bind(o);if(Array.isArray(t)||(o=function(t,e){if(t){if("string"==typeof t)return r(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?r(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){o&&(t=o);var s=0;return function(){return s>=t.length?{done:!0}:{done:!1,value:t[s++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function s(){}s.prototype={on:function(t,e,r){var o=this.e||(this.e={});return(o[t]||(o[t]=[])).push({fn:e,ctx:r}),this},once:function(t,e,r){var o=this;function s(){o.off(t,s),e.apply(r,arguments)}return s._=e,this.on(t,s,r)},emit:function(t){for(var e=[].slice.call(arguments,1),r=((this.e||(this.e={}))[t]||[]).slice(),o=0,s=r.length;o<s;o++)r[o].fn.apply(r[o].ctx,e);return this},off:function(t,e){var r=this.e||(this.e={}),o=r[t],s=[];if(o&&e)for(var n=0,a=o.length;n<a;n++)o[n].fn!==e&&o[n].fn._!==e&&s.push(o[n]);return s.length?r[t]=s:delete r[t],this}};var n=s;n.TinyEmitter=s;var a=/*#__PURE__*/function(r){var s,n;function a(t){var o;return void 0===t&&(t={}),(o=r.call(this)||this).intersect=o.intersect.bind(e(o)),o.mutate=o.mutate.bind(e(o)),o.options=Object.assign({root:null,rootMargin:"0px",threshold:0,once:!1},t),o.observers=[o.createObserver()],o.createObservers(),o.createMutationObserver(),o.observe(),o}n=r,(s=a).prototype=Object.create(n.prototype),s.prototype.constructor=s,t(s,n);var i=a.prototype;return i.createObservers=function(){for(var t,e=o((this.options.root?this.options.root:document).querySelectorAll("[data-cartapus]"));!(t=e()).done;)this.storeNewElement(t.value)},i.findObserverForElement=function(t){var e=t.dataset.cartapusThreshold?parseFloat(t.dataset.cartapusThreshold):this.options.threshold,r=t.dataset.cartapusRootMargin?t.dataset.cartapusRootMargin:this.options.rootMargin;return this.observers.find(function(t){return t.threshold===e&&t.rootMargin===r})},i.storeNewElement=function(t){if(!t.hasAttribute("data-cartapus"))return!1;if(t.dataset.cartapusThreshold||t.dataset.cartapusRootMargin){var e=this.findObserverForElement(t);if(e)e.elements.push(t),t._cartapus=e;else{var r=t.dataset.cartapusThreshold?parseFloat(t.dataset.cartapusThreshold):this.options.threshold;this.observers.push(this.createObserver({element:t,options:{threshold:r,rootMargin:t.dataset.cartapusRootMargin?t.dataset.cartapusRootMargin:this.options.rootMargin}}))}}else this.observers[0].elements.push(t),t._cartapus=this.observers[0];return!0},i.createObserver=function(t){var e=void 0===t?{}:t,r=e.element,o=Object.assign(this.options,e.options),s={observer:new IntersectionObserver(this.intersect,o),threshold:o.threshold,rootMargin:o.rootMargin,elements:r?[r]:[]};return r&&(r._cartapus=s),s},i.createMutationObserver=function(){this.mutationObserver=new MutationObserver(this.mutate),this.mutationObserver.observe(this.options.root?this.options.root:document.body,{childList:!0,subtree:!0})},i.intersect=function(t,e){for(var r,s=o(t);!(r=s()).done;){var n=r.value;n.isIntersecting?(n.target.setAttribute("data-cartapus","visible"),n.target.hasAttribute("data-cartapus-once")&&e.unobserve(n.target)):n.target.setAttribute("data-cartapus","hidden"),this.dispatch(n)}},i.dispatch=function(t){var e={element:t.target,visible:t.isIntersecting,intersection:t},r=new CustomEvent("cartapusintersect",{detail:e});t.target.dispatchEvent(r),this.emit("intersect",e)},i.mutate=function(t){for(var e,r=o(t);!(e=r()).done;){var s=e.value;if("childList"===s.type){for(var n,a=o(s.addedNodes);!(n=a()).done;){var i=n.value;this.storeNewElement(i)&&i._cartapus.observer.observe(i)}for(var u,c=o(s.removedNodes);!(u=c()).done;){var v=u.value;if(v._cartapus){var h=v._cartapus.elements.indexOf(v);v._cartapus.elements.splice(h,1),v._cartapus.observer.unobserve(v)}}}}},i.observe=function(){for(var t,e=o(this.observers);!(t=e()).done;)for(var r,s=t.value,n=o(s.elements);!(r=n()).done;)s.observer.observe(r.value)},i.unobserve=function(){for(var t,e=o(this.observers);!(t=e()).done;)for(var r,s=t.value,n=o(s.elements);!(r=n()).done;)s.observer.unobserve(r.value)},i.destroy=function(){this.unobserve(),this.mutationObserver.disconnect();for(var t,e=o(this.observers);!(t=e()).done;){for(var r,s=t.value,n=o(s.elements);!(r=n()).done;)delete r.value._cartapus;s.observer.disconnect(),s.elements=[]}},a}(n);export{a as default};
